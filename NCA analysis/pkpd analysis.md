# Pharmacokinetic analysis of Eprex

## load packages

``` r
# install.packages(c("dplyr", "ggplot2", "tidyr", "readr", "data.table", "lubridate", "caret", "plotly", "knitr", "survival"))
# install.packages(c("meta","metafor","pkr"))
# install.packages("openxlsx")
```

``` r
library(openxlsx)
library(dplyr)
library(tidyr)
library(readr)
library(knitr)
library(pkr)
```
## load and prepare data

``` r
data  <- read.xlsx("Kinetic_clean.xlsx")
df <- data  %>% mutate(across(seq(5,17,2),.fns = as.double))  %>% 
    mutate(gender_recoded = as.factor(gender))  %>%  
    mutate(c0 = level0, dose = 20000)  %>% 
    reshape(varying = c('level0','level1','level2','level3','level6','level8','level10'), 
        times = c(0,1,2,3,6,8,10), 
        v.names = "concentration", 
        idvar = 'ID',
        drop = c(seq(4,18,2)),
        direction = "long")  %>% 
    arrange(ID)  %>% 
    drop_na(concentration) %>% 
    mutate(, time= time*24) %>% 
    mutate(concentration = concentration*0.005) %>% 
    select(ID,time,concentration)
```

```
## Warning: There were 6 warnings in `mutate()`.
## The first warning was:
## ℹ In argument: `across(seq(5, 17, 2), .fns = as.double)`.
## Caused by warning:
## ! NAs introduced by coercion
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 5 remaining warnings.
```

``` r
# View(df)
# glimpse(df)
```
## analyze

``` r
pk <- NCA(
    concData = df,
    id ="ID",
    Time = "time",
    conc = "concentration",
    fit = "Linear",
    iAUC = data.frame(Name = "AUC[0-48h]",Start = 0, End = 2),
    dose = 0.1,
    uTime = "h",
    adm = "Bolus"
)
```

```
## Warning in rbind(deparse.level, ...): number of columns of result, 40, is not a
## multiple of vector length 11 of arg 2
```
### output

``` r
# //NOTE - create summary measures
m <- data.frame(pk)  %>% summarise_all(.funs = mean) %>% mutate(ID="Mean")
```

```
## Warning: There was 1 warning in `summarise()`.
## ℹ In argument: `ID = (function (x, ...) ...`.
## Caused by warning in `mean.default()`:
## ! argument is not numeric or logical: returning NA
```

``` r
sd <- data.frame(pk)  %>% summarise_all(.funs = stats::sd) %>% mutate(ID = "SD")
#//NOTE - special function to return p-value for swilk test 
sw <- function(x){
    result <- shapiro.test(as.double(x))
    return(result$p.value)
}
pv  <- data.frame(pk) %>% summarise_all(.funs = sw)  %>% mutate(ID="SWilk p-value")
pk <- data.frame(pk) %>% bind_rows(m,sd,pv)

# View(pk)
kable(pk)
```



|ID            |      CMAX|       CMAXD|       TMAX|        C0|     AUCPBEO|   AUCPBEP|       CLST|      CLSTP|         TLST|      LAMZHL|      LAMZ|      LAMZLL|      LAMZUL|   LAMZNPT|     CORRXY|          R2|      R2ADJ|      AUCLST|      AUCALL|       AUCIFO|      AUCIFOD|      AUCPEO|       AUCIFP|    AUCIFPD|     AUCPEP|      AUMCLST|      AUMCIFO|      AUMCPEO|    AUMCIFP|    AUMCPEP|     MRTIVLST|    MRTIVIFO|    MRTIVIFP|          VZO|          VZP|       CLO|       CLP|         VSSO|         VSSP| AUC.0.48h.|
|:-------------|---------:|-----------:|----------:|---------:|-----------:|---------:|----------:|----------:|------------:|-----------:|---------:|-----------:|-----------:|---------:|----------:|-----------:|----------:|-----------:|-----------:|------------:|------------:|-----------:|------------:|----------:|----------:|------------:|------------:|------------:|----------:|----------:|------------:|-----------:|-----------:|------------:|------------:|---------:|---------:|------------:|------------:|----------:|
|1             | 2.7500000|  27.5000000| 24.0000000| 0.0925000|   0.0000000| 0.0000000|  0.1160000|  0.1189551|  192.0000000|  86.7938094| 0.0079861|  72.0000000| 192.0000000| 3.0000000| -0.9971413|   0.9942909|  0.9885817| 103.3500000| 103.3500000|  117.8751718| 1178.7517181| 118.2451978| 1182.4519781|  12.322503| 12.5968733| 5.124096e+03| 9.731727e+03| 9.849106e+03| 47.3464906| 47.9739985|   49.5800290|  82.5596031|  83.2939191|  106.2284758|  105.8960539| 0.8483551| 0.8457003|   70.0398581|   70.4416929|  0.4064583|
|2             | 0.1055000|   1.0550000| 48.0000000| 0.0515000|   0.0000000| 0.0000000|  0.0400000|  0.0390047|  240.0000000| 173.2431777| 0.0040010|  72.0000000| 240.0000000| 3.0000000| -0.9887174|   0.9775621|  0.9551243|  15.2340000|  15.2340000|   25.2314829|  252.3148293|  24.9827174|  249.8271741|  39.623049| 39.0218456| 1.552608e+03| 6.450746e+03| 6.328866e+03| 75.9313401| 75.4678329|  101.9172903| 255.6625603| 253.3297708|  990.5762335| 1000.4399010| 3.9633025| 4.0027671| 1013.2680708| 1014.0200790|  0.1050833|
|3             | 0.4825000|   4.8250000| 48.0000000| 0.0825000|   0.0000000| 0.0000000|  0.0372500|  0.0427295|  192.0000000|  41.9898454| 0.0165075|  48.0000000| 192.0000000| 4.0000000| -0.9856749|   0.9715550|  0.9573324|  38.9100000|  38.9100000|   41.1665507|  411.6655068|  41.4984913|  414.9849125|   5.481515|  6.2375551| 2.817504e+03| 3.387460e+03| 3.471301e+03| 16.8254749| 18.8343587|   72.4107941|  82.2867164|  83.6488567|  147.1547671|  145.9776969| 2.4291566| 2.4097262|  199.8873236|  201.5708382|  0.1771250|
|4             | 0.6725000|   6.7250000| 48.0000000| 0.0810000|   0.0000000| 0.0000000|  0.0525000|  0.0483272|  144.0000000|  27.9055182| 0.0248391|  48.0000000| 144.0000000| 3.0000000| -0.9722488|   0.9452678|  0.8905356|  31.8660000|  31.8660000|   33.9796055|  339.7960552|  33.8116114|  338.1161137|   6.220218|  5.7542699| 1.833696e+03| 2.223147e+03| 2.192193e+03| 17.5180109| 16.3533390|   57.5439654|  65.4259262|  64.8354992|  118.4803416|  119.0690152| 2.9429418| 2.9575639|  192.5446902|  191.7551297|  0.1653333|
|5             | 0.5495000|   5.4950000| 24.0000000| 0.1720000|   0.0000000| 0.0000000|  0.1955000|  0.1956622|  240.0000000| 388.7329042| 0.0017831| 144.0000000| 240.0000000| 3.0000000| -0.9998592|   0.9997184|  0.9994368|  62.9040000|  62.9040000|  172.5449030| 1725.4490299| 172.6358680| 1726.3586799|  63.543403| 63.5626126| 6.673824e+03| 9.447678e+04| 9.454963e+04| 92.9360170| 92.9414595|  106.0953834| 547.5489734| 547.6824281|  325.0301942|  324.8589298| 0.5795593| 0.5792539|  317.3370896|  317.2471830|  0.3754583|
|6             | 1.5300000|  15.3000000| 48.0000000| 0.3500000|   0.0000000| 0.0000000|  0.1510000|  0.1549669|  144.0000000|  28.1052285| 0.0246626|  48.0000000| 144.0000000| 3.0000000| -0.9971333|   0.9942748|  0.9885495| 117.6360000| 117.6360000|  123.7586383| 1237.5863835| 123.9194859| 1239.1948588|   4.947241|  5.0706197| 6.934464e+03| 8.064380e+03| 8.094064e+03| 14.0111972| 14.3265504|   58.9484852|  65.1621602|  65.3171221|   32.7631868|   32.7206602| 0.8080244| 0.8069756|   52.6526156|   52.7093230|  0.7491667|
|7             | 3.2100000|  32.1000000| 24.0000000| 0.7700000|   0.0000000| 0.0000000|  0.4890000|  0.4617358|  144.0000000|  42.4337062| 0.0163348|  24.0000000| 144.0000000| 4.0000000| -0.9748362|   0.9503057|  0.9254585| 225.6840000| 225.6840000|  255.6200409| 2556.2004091| 253.9509585| 2539.5095849|  11.711148| 11.1308729| 1.157242e+04| 1.771586e+04| 1.737333e+04| 34.6776405| 33.3897649|   51.2770777|  69.3054318|  68.4121460|   23.9491776|   24.1065826| 0.3912056| 0.3937768|   27.1126753|   26.9391171|  1.7433333|
|8             | 4.2650000| 240.0000000|  1.1944061| 0.4265000| 240.0000000| 0.0000000| 75.5688731| 75.5688731| 8920.5120000| 118.0447932| 2.3178617|   4.2650000| 240.0000000| 1.1944061|  0.4265000| 240.0000000|  0.0000000|  75.5688731|  75.5688731| 8920.5120000|  118.0447932|   2.3178617|    4.2650000| 240.000000|  1.1944061| 4.265000e-01| 2.400000e+02| 0.000000e+00| 75.5688731| 75.5688731| 8920.5120000| 118.0447932|   2.3178617|    4.2650000|  240.0000000| 1.1944061| 0.4265000|  240.0000000|    0.0000000| 75.5688731|
|9             | 1.5350000|  15.3500000| 24.0000000| 0.3430000|   0.0000000| 0.0000000|  0.0345000|  0.0209366|  240.0000000|  37.3912515| 0.0185377|  24.0000000| 240.0000000| 6.0000000| -0.9682326|   0.9374744|  0.9218429|  91.5660000|  91.5660000|   93.4270740|  934.2707397|  92.6954063|  926.9540635|   1.992007|  1.2184060| 4.985568e+03| 5.532620e+03| 5.317550e+03|  9.8877542|  6.2431456|   54.4478081|  59.2185928|  57.3658461|   57.7393370|   58.1950878| 1.0703535| 1.0788021|   63.3848308|   61.8863958|  0.7853333|
|10            | 0.0975000|   0.9750000| 24.0000000| 0.0655000|   0.0000000| 0.0000000|  0.0260500|  0.0148803|  240.0000000| 139.8610691| 0.0049560|  24.0000000| 240.0000000| 5.0000000| -0.4477481|   0.2004784| -0.0660289|   7.2276000|   7.2276000|   12.4838875|  124.8388748|  10.2301059|  102.3010586|  42.104573| 29.3497047| 5.997888e+02| 2.921895e+03| 1.926226e+03| 79.4726096| 68.8619787|   82.9858874| 234.0532979| 188.2899814| 1616.2983768| 1972.3830194| 8.0103253| 9.7750699| 1874.8430585| 1840.5477330|  0.1336667|
|11            | 1.1740000|  11.7400000| 48.0000000| 0.1835000|   2.3720712| 2.2530261|  0.3295000|  0.4087197|  192.0000000|  85.8335645| 0.0080755|  48.0000000| 192.0000000| 3.0000000| -0.9010429|   0.8118782|  0.6237564| 144.8580000| 144.8580000|  185.6605313| 1856.6053126| 195.4704377| 1954.7043772|  21.976955| 25.8926303| 1.363133e+04| 2.651806e+04| 2.961634e+04| 48.5960569| 53.9736211|   94.1013130| 142.8308909| 151.5131314|   66.6978905|   63.3505809| 0.5386174| 0.5115863|   76.9312088|   77.5120438|  0.3670000|
|12            | 1.6890000|  16.8900000| 24.0000000| 0.1795000|   0.0000000| 0.0000000|  0.0870000|  0.0584091|   72.0000000|  11.2175477| 0.0617913|  24.0000000|  72.0000000| 3.0000000| -0.9066396|   0.8219953|  0.6439906|  46.5180000|  46.5180000|   47.9259645|  479.2596454|  47.4632635|  474.6326351|   2.937791|  1.9915687| 1.181664e+03| 1.305823e+03| 1.265021e+03|  9.5081200|  6.5893506|   25.4022959|  27.2466763|  26.6526267|   33.7677093|   34.0968977| 2.0865516| 2.1068926|   56.8515971|   56.1542228|  0.4847917|
|13            | 0.4560000|   4.5600000| 24.0000000| 0.2510000|   0.0000000| 0.0000000|  0.1125000|  0.1029357|   72.0000000|  23.7728643| 0.0291571|  24.0000000|  72.0000000| 3.0000000| -0.9766618|   0.9538683|  0.9077366|  19.4700000|  19.4700000|   23.3284118|  233.2841176|  23.0003858|  230.0038583|  16.539539| 15.3492461| 5.597280e+02| 9.698656e+02| 9.349974e+02| 42.2880843| 40.1358763|   28.7482280|  41.5744363|  40.6513789|  147.0181243|  149.1148612| 4.2866184| 4.3477532|  178.2137453|  176.7421608|  0.5190833|
|Mean          | 1.4243462|  29.4242308| 31.4764928| 0.2345000|  18.6440055| 0.1733097|  5.9415133|  5.9412412|  848.6547692|  92.7173292| 0.1951149|  46.4819231| 180.9230769| 3.3995697| -0.8222643|  19.2737438|  0.7489474|  75.4455749|  75.4455749|  773.3472509|  880.6205704|  87.7093685|  875.6387919|  36.107688| 16.7977393| 4.420547e+03| 1.381064e+04| 1.391682e+04| 43.4282823| 42.3584730|  746.4592737| 137.7630815| 125.6392745|  282.3052934|  328.4776374| 2.2422629| 2.3263360|  335.6205203|  314.4250707|  6.2754390|
|SD            | 1.2853867|  63.9959771| 14.9259892| 0.2015402|  66.5124302| 0.6248770| 20.9208509| 20.9209885| 2426.0102435| 102.0578525| 0.6379998|  35.5091432|  61.6690921| 1.1613441|  0.4032193|  66.3203293|  0.3676071|  61.8120508|  61.8120508| 2449.0590399|  781.7222028|  80.0033790|  801.7314716|  64.020146| 18.3698015| 4.332220e+03| 2.536895e+04| 2.558429e+04| 29.5516054| 29.3133144| 2456.1293055| 141.5572588| 144.3599997|  478.0545239|  557.5833498| 2.1703847| 2.6233026|  529.6293071|  529.2584286| 20.8245648|
|SWilk p-value | 0.0734075|   0.0000038|  0.0037134| 0.0121066|   0.0000005| 0.0000005|  0.0000005|  0.0000005|    0.0000007|   0.0011364| 0.0000007|   0.0080597|   0.0223261| 0.0133388|  0.0000099|   0.0000005|  0.0003438|   0.1438883|   0.1438883|    0.0000007|    0.0581847|   0.0976294|    0.1077042|   0.000025|  0.0111237| 5.168960e-02| 2.340000e-05| 2.940000e-05|  0.1183436|  0.3091081|    0.0000006|   0.0006306|   0.0007534|    0.0000718|    0.0000496| 0.0074312| 0.0014755|    0.0000676|    0.0000689|  0.0000006|
### plot

``` r
plotPK(
    concData = df,
    id ="ID",
    Time = "time",
    conc = "concentration",
    fit = "Linear",
    dose = 0.1,
    unitTime = "h",
    adm = "Bolus"
)
```

```
## Warning in rbind(deparse.level, ...): number of columns of result, 39, is not a
## multiple of vector length 10 of arg 2
```

```
## Error in rbind(deparse.level, ...): numbers of columns of arguments do not match
```

``` r
write.csv(pk,"result.csv")
knit("pkpd analysis.rmd")
```

```
## 
## 
## processing file: pkpd analysis.rmd
```

```
## Error in parse_block(g[-1], g[1], params.src, markdown_mode): Duplicate chunk label 'install', which has been used for the chunk:
## # install.packages(c("dplyr", "ggplot2", "tidyr", "readr", "data.table", "lubridate", "caret", "plotly", "knitr", "survival"))
## # install.packages(c("meta","metafor","pkr"))
## # install.packages("openxlsx")
```

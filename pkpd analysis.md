# Pharmacokinetic analysis of Eprex

## load packages

``` r
# install.packages(c("dplyr", "ggplot2", "tidyr", "readr", "data.table", "lubridate", "caret", "plotly", "knitr", "survival"))
# install.packages(c("meta","metafor","pkr"))
# install.packages("openxlsx")
```

``` r
library(openxlsx)
library(dplyr)
library(tidyr)
library(readr)
library(knitr)
library(pkr)
```
## load and prepare data

``` r
data  <- read.xlsx("Kinetic_clean.xlsx")
df <- data  %>% mutate(across(seq(5,17,2),.fns = as.double))  %>% 
    mutate(gender_recoded = as.factor(gender))  %>%  
    mutate(c0 = level0, dose = 20000)  %>% 
    reshape(varying = c('level0','level1','level2','level3','level6','level8','level10'), 
        times = c(0,1,2,3,6,8,10), 
        v.names = "concentration", 
        idvar = 'ID',
        drop = c(seq(4,18,2)),
        direction = "long")  %>% 
    arrange(ID)  %>% 
    drop_na(concentration) %>% 
    mutate(, time= time*24) %>% 
    mutate(concentration = concentration*0.1) %>% 
    select(ID,time,concentration)
```

```
## Warning: There were 6 warnings in `mutate()`.
## The first warning was:
## ℹ In argument: `across(seq(5, 17, 2), .fns = as.double)`.
## Caused by warning:
## ! NAs introduced by coercion
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 5 remaining warnings.
```

``` r
# View(df)
# glimpse(df)
```
## analyze

``` r
pk <- NCA(
    concData = df,
    id ="ID",
    Time = "time",
    conc = "concentration",
    fit = "Linear",
    iAUC = data.frame(Name = "AUC[0-48h]",Start = 0, End = 2),
    dose = 0.1,
    uTime = "h",
    adm = "Bolus"
)
```

```
## Warning in rbind(deparse.level, ...): number of columns of result, 40, is not a
## multiple of vector length 11 of arg 2
```
### output

``` r
# //NOTE - create summary measures
m <- data.frame(pk)  %>% summarise_all(.funs = mean) %>% mutate(ID="Mean")
```

```
## Warning: There was 1 warning in `summarise()`.
## ℹ In argument: `ID = (function (x, ...) ...`.
## Caused by warning in `mean.default()`:
## ! argument is not numeric or logical: returning NA
```

``` r
sd <- data.frame(pk)  %>% summarise_all(.funs = stats::sd) %>% mutate(ID = "SD")
#//NOTE - special function to return p-value for swilk test 
sw <- function(x){
    result <- shapiro.test(as.double(x))
    return(result$p.value)
}
pv  <- data.frame(pk) %>% summarise_all(.funs = sw)  %>% mutate(ID="SWilk p-value")
pk <- data.frame(pk) %>% bind_rows(m,sd,pv)

# View(pk)
kable(pk)
```



|ID            |       CMAX|       CMAXD|       TMAX|         C0|     AUCPBEO|   AUCPBEP|         CLST|        CLSTP|         TLST|      LAMZHL|       LAMZ|      LAMZLL|      LAMZUL|   LAMZNPT|     CORRXY|          R2|      R2ADJ|       AUCLST|       AUCALL|       AUCIFO|      AUCIFOD|       AUCPEO|       AUCIFP|    AUCIFPD|     AUCPEP|      AUMCLST|      AUMCIFO|      AUMCPEO|      AUMCIFP|      AUMCPEP|     MRTIVLST|    MRTIVIFO|    MRTIVIFP|        VZO|        VZP|        CLO|       CLP|        VSSO|       VSSP|   AUC.0.48h.|
|:-------------|----------:|-----------:|----------:|----------:|-----------:|---------:|------------:|------------:|------------:|-----------:|----------:|-----------:|-----------:|---------:|----------:|-----------:|----------:|------------:|------------:|------------:|------------:|------------:|------------:|----------:|----------:|------------:|------------:|------------:|------------:|------------:|------------:|-----------:|-----------:|----------:|----------:|----------:|---------:|-----------:|----------:|------------:|
|1             | 55.0000000| 550.0000000| 24.0000000|  1.8500000|   0.0000000| 0.0000000|    2.3200000|    2.3791016| 1.920000e+02|  86.7938094|  0.0079861|  72.0000000| 192.0000000|  3.000000| -0.9971413|   0.9942909|  0.9885817| 2067.0000000| 2067.0000000| 2.357503e+03| 2.357503e+04| 2364.9039562| 2.364904e+04|  12.322503| 12.5968733| 1.024819e+05| 1.946345e+05| 1.969821e+05|   47.3464906|   47.9739985| 4.958003e+01|  82.5596031|  83.2939191|  5.3114238|   5.294803|  0.0424178| 0.0422850|   3.5019929|  3.5220846|    8.1291667|
|2             |  2.1100000|  21.1000000| 48.0000000|  1.0300000|   0.0000000| 0.0000000|    0.8000000|    0.7800937| 2.400000e+02| 173.2431777|  0.0040010|  72.0000000| 240.0000000|  3.000000| -0.9887174|   0.9775621|  0.9551243|  304.6800000|  304.6800000| 5.046297e+02| 5.046297e+03|  499.6543481| 4.996543e+03|  39.623049| 39.0218456| 3.105216e+04| 1.290149e+05| 1.265773e+05|   75.9313401|   75.4678329| 1.019173e+02| 255.6625603| 253.3297708| 49.5288117|  50.021995|  0.1981651| 0.2001384|  50.6634035| 50.7010040|    2.1016667|
|3             |  9.6500000|  96.5000000| 48.0000000|  1.6500000|   0.0000000| 0.0000000|    0.7450000|    0.8545901| 1.920000e+02|  41.9898454|  0.0165075|  48.0000000| 192.0000000|  4.000000| -0.9856749|   0.9715550|  0.9573324|  778.2000000|  778.2000000| 8.233310e+02| 8.233310e+03|  829.9698251| 8.299698e+03|   5.481515|  6.2375551| 5.635008e+04| 6.774921e+04| 6.942603e+04|   16.8254749|   18.8343587| 7.241079e+01|  82.2867164|  83.6488567|  7.3577384|   7.298885|  0.1214578| 0.1204863|   9.9943662| 10.0785419|    3.5425000|
|4             | 13.4500000| 134.5000000| 48.0000000|  1.6200000|   0.0000000| 0.0000000|    1.0500000|    0.9665436| 1.440000e+02|  27.9055182|  0.0248391|  48.0000000| 144.0000000|  3.000000| -0.9722488|   0.9452678|  0.8905356|  637.3200000|  637.3200000| 6.795921e+02| 6.795921e+03|  676.2322275| 6.762322e+03|   6.220218|  5.7542699| 3.667392e+04| 4.446294e+04| 4.384385e+04|   17.5180109|   16.3533390| 5.754397e+01|  65.4259262|  64.8354992|  5.9240171|   5.953451|  0.1471471| 0.1478782|   9.6272345|  9.5877565|    3.3066667|
|5             | 10.9900000| 109.9000000| 24.0000000|  3.4400000|   0.0000000| 0.0000000|    3.9100000|    3.9132440| 2.400000e+02| 388.7329042|  0.0017831| 144.0000000| 240.0000000|  3.000000| -0.9998592|   0.9997184|  0.9994368| 1258.0800000| 1258.0800000| 3.450898e+03| 3.450898e+04| 3452.7173598| 3.452717e+04|  63.543403| 63.5626126| 1.334765e+05| 1.889536e+06| 1.890993e+06|   92.9360170|   92.9414595| 1.060954e+02| 547.5489734| 547.6824281| 16.2515097|  16.242946|  0.0289780| 0.0289627|  15.8668545| 15.8623592|    7.5091667|
|6             | 30.6000000| 306.0000000| 48.0000000|  7.0000000|   0.0000000| 0.0000000|    3.0200000|    3.0993383| 1.440000e+02|  28.1052285|  0.0246626|  48.0000000| 144.0000000|  3.000000| -0.9971333|   0.9942748|  0.9885495| 2352.7200000| 2352.7200000| 2.475173e+03| 2.475173e+04| 2478.3897175| 2.478390e+04|   4.947241|  5.0706197| 1.386893e+05| 1.612876e+05| 1.618813e+05|   14.0111972|   14.3265504| 5.894849e+01|  65.1621602|  65.3171221|  1.6381593|   1.636033|  0.0404012| 0.0403488|   2.6326308|  2.6354662|   14.9833333|
|7             | 64.2000000| 642.0000000| 24.0000000| 15.4000000|   0.0000000| 0.0000000|    9.7800000|    9.2347166| 1.440000e+02|  42.4337062|  0.0163348|  24.0000000| 144.0000000|  4.000000| -0.9748362|   0.9503057|  0.9254585| 4513.6800000| 4513.6800000| 5.112401e+03| 5.112401e+04| 5079.0191697| 5.079019e+04|  11.711148| 11.1308729| 2.314483e+05| 3.543171e+05| 3.474666e+05|   34.6776405|   33.3897649| 5.127708e+01|  69.3054318|  68.4121460|  1.1974589|   1.205329|  0.0195603| 0.0196888|   1.3556338|  1.3469559|   34.8666667|
|8             | 85.3000000| 240.0000000| 23.8881218|  8.5300000| 240.0000000| 0.0000000| 1511.3774619| 1511.3774619| 1.784102e+05| 118.0447932| 46.3572335|  85.3000000| 240.0000000| 23.888122|  8.5300000| 240.0000000|  0.0000000| 1511.3774619| 1511.3774619| 1.784102e+05| 1.180448e+02|   46.3572335| 8.530000e+01| 240.000000| 23.8881218| 8.530000e+00| 2.400000e+02| 0.000000e+00| 1511.3774619| 1511.3774619| 1.784102e+05| 118.0447932|  46.3572335| 85.3000000| 240.000000| 23.8881218| 8.5300000| 240.0000000|  0.0000000| 1511.3774619|
|9             | 30.7000000| 307.0000000| 24.0000000|  6.8600000|   0.0000000| 0.0000000|    0.6900000|    0.4187315| 2.400000e+02|  37.3912515|  0.0185377|  24.0000000| 240.0000000|  6.000000| -0.9682326|   0.9374744|  0.9218429| 1831.3200000| 1831.3200000| 1.868541e+03| 1.868541e+04| 1853.9081270| 1.853908e+04|   1.992007|  1.2184060| 9.971136e+04| 1.106524e+05| 1.063510e+05|    9.8877542|    6.2431456| 5.444781e+01|  59.2185928|  57.3658461|  2.8869668|   2.909754|  0.0535177| 0.0539401|   3.1692415|  3.0943198|   15.7066667|
|10            |  1.9500000|  19.5000000| 24.0000000|  1.3100000|   0.0000000| 0.0000000|    0.5210000|    0.2976065| 2.400000e+02| 139.8610691|  0.0049560|  24.0000000| 240.0000000|  5.000000| -0.4477481|   0.2004784| -0.0660289|  144.5520000|  144.5520000| 2.496777e+02| 2.496777e+03|  204.6021171| 2.046021e+03|  42.104573| 29.3497047| 1.199578e+04| 5.843790e+04| 3.852453e+04|   79.4726096|   68.8619787| 8.298589e+01| 234.0532979| 188.2899814| 80.8149188|  98.619151|  0.4005163| 0.4887535|  93.7421529| 92.0273866|    2.6733333|
|11            | 23.4800000| 234.8000000| 48.0000000|  3.6700000|   2.3720712| 2.2530261|    6.5900000|    8.1743939| 1.920000e+02|  85.8335645|  0.0080755|  48.0000000| 192.0000000|  3.000000| -0.9010429|   0.8118782|  0.6237564| 2897.1600000| 2897.1600000| 3.713211e+03| 3.713211e+04| 3909.4087545| 3.909409e+04|  21.976955| 25.8926303| 2.726266e+05| 5.303612e+05| 5.923268e+05|   48.5960569|   53.9736211| 9.410131e+01| 142.8308909| 151.5131314|  3.3348945|   3.167529|  0.0269309| 0.0255793|   3.8465604|  3.8756022|    7.3400000|
|12            | 33.7800000| 337.8000000| 24.0000000|  3.5900000|   0.0000000| 0.0000000|    1.7400000|    1.1681818| 7.200000e+01|  11.2175477|  0.0617913|  24.0000000|  72.0000000|  3.000000| -0.9066396|   0.8219953|  0.6439906|  930.3600000|  930.3600000| 9.585193e+02| 9.585193e+03|  949.2652703| 9.492653e+03|   2.937791|  1.9915687| 2.363328e+04| 2.611646e+04| 2.530041e+04|    9.5081200|    6.5893506| 2.540230e+01|  27.2466763|  26.6526267|  1.6883855|   1.704845|  0.1043276| 0.1053446|   2.8425799|  2.8077111|    9.6958333|
|13            |  9.1200000|  91.2000000| 24.0000000|  5.0200000|   0.0000000| 0.0000000|    2.2500000|    2.0587145| 7.200000e+01|  23.7728643|  0.0291571|  24.0000000|  72.0000000|  3.000000| -0.9766618|   0.9538683|  0.9077366|  389.4000000|  389.4000000| 4.665682e+02| 4.665682e+03|  460.0077166| 4.600077e+03|  16.539539| 15.3492461| 1.119456e+04| 1.939731e+04| 1.869995e+04|   42.2880843|   40.1358763| 2.874823e+01|  41.5744363|  40.6513789|  7.3509062|   7.455743|  0.2143309| 0.2173877|   8.9106873|  8.8371080|   10.3816667|
|Mean          | 28.4869231| 237.7153846| 33.2221632|  4.6900000|  18.6440055| 0.1733097|  118.8302663|  118.8248245| 1.388633e+04|  92.7173292|  3.5827589|  52.7153846| 180.9230769|  5.145240| -0.1989182|  19.2737438|  0.7489474| 1508.9114971| 1508.9114971| 1.546695e+04| 1.743988e+04| 1754.1873710| 1.751278e+04|  36.107688| 18.5434097| 8.841094e+04| 2.758621e+05| 2.783363e+05|  153.8750968|  152.8052875| 1.378413e+04| 137.7630815| 129.0269185| 20.6603993|  33.962343|  1.9450671| 0.7708303|  34.3194876| 15.7212535|  125.5087791|
|SD            | 25.7077334| 192.2239226| 12.1599914|  4.0308043|  66.5124302| 0.6248770|  418.4170185|  418.4197700| 4.943332e+04| 102.0578525| 12.8521397|  34.5811087|  61.6690921|  5.711734|  2.6268673|  66.3203293|  0.3676071| 1236.2410156| 1236.2410156| 4.898118e+04| 1.582795e+04| 1600.0675796| 1.603463e+04|  64.020146| 17.8339308| 8.664440e+04| 5.075838e+05| 5.116858e+05|  408.8337947|  409.1296269| 4.946400e+04| 141.5572588| 141.7174406| 30.5139041|  67.881586|  6.5939417| 2.3348528|  67.2187344| 26.4629214|  416.4912965|
|SWilk p-value |  0.0734075|   0.1389602|  0.0001197|  0.0121066|   0.0000005| 0.0000005|    0.0000005|    0.0000005| 5.000000e-07|   0.0011364|  0.0000005|   0.0066753|   0.0223261|  0.000003|  0.0000008|   0.0000005|  0.0003438|    0.1438883|    0.1438883| 7.000000e-07| 1.077968e-01|    0.0976294| 1.077042e-01|   0.000025|  0.0349235| 5.168960e-02| 2.410000e-05| 2.940000e-05|    0.0000012|    0.0000012| 5.000000e-07|   0.0006306|   0.0003132|  0.0002188|   0.000026|  0.0000006| 0.0000009|   0.0000256|  0.0000689|    0.0000006|
### plot

``` r
plotPK(
    concData = df,
    id ="ID",
    Time = "time",
    conc = "concentration",
    fit = "Linear",
    dose = 0.1,
    unitTime = "h",
    adm = "Bolus"
)
```

```
## Warning in rbind(deparse.level, ...): number of columns of result, 39, is not a
## multiple of vector length 10 of arg 2
```

```
## Error in rbind(deparse.level, ...): numbers of columns of arguments do not match
```

``` r
write.csv(pk,"result.csv")
knit("pkpd analysis.rmd")
```

```
## 
## 
## processing file: pkpd analysis.rmd
```

```
## Error in parse_block(g[-1], g[1], params.src, markdown_mode): Duplicate chunk label 'install', which has been used for the chunk:
## # install.packages(c("dplyr", "ggplot2", "tidyr", "readr", "data.table", "lubridate", "caret", "plotly", "knitr", "survival"))
## # install.packages(c("meta","metafor","pkr"))
## # install.packages("openxlsx")
```

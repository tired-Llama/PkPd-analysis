# Pharmacokinetic analysis of Eprex

## load packages

``` r
# install.packages(c("dplyr", "ggplot2", "tidyr", "readr", "data.table", "lubridate", "caret", "plotly", "knitr", "survival"))
# install.packages(c("meta","metafor","pkr"))
# install.packages("openxlsx")
```

``` r
library(openxlsx)
library(dplyr)
library(tidyr)
library(readr)
library(knitr)
library(pkr)
```
## load and prepare data

``` r
data  <- read.xlsx("Kinetic_clean.xlsx")
df <- data  %>% mutate(across(seq(5,17,2),.fns = as.double))  %>% 
    mutate(gender_recoded = as.factor(gender))  %>%  
    mutate(c0 = level0, dose = 20000)  %>% 
    reshape(varying = c('level0','level1','level2','level3','level6','level8','level10'), 
        times = c(0,1,2,3,6,8,10), 
        v.names = "concentration", 
        idvar = 'ID',
        drop = c(seq(4,18,2)),
        direction = "long")  %>% 
    arrange(ID)  %>% 
    drop_na(concentration) %>% 
    select(ID,time,concentration)
```

```
## Warning: There were 6 warnings in `mutate()`.
## The first warning was:
## ℹ In argument: `across(seq(5, 17, 2), .fns = as.double)`.
## Caused by warning:
## ! NAs introduced by coercion
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 5 remaining warnings.
```

``` r
# View(df)
# glimpse(df)
```
## analyze

``` r
pk <- NCA(
    concData = df,
    id ="ID",
    Time = "time",
    conc = "concentration",
    fit = "Linear",
    iAUC = data.frame(Name = "AUC[0-48h]",Start = 0, End = 2),
    dose = 20000,
    adm = "Bolus"
)
```

```
## Warning in rbind(deparse.level, ...): number of columns of result, 40, is not a
## multiple of vector length 11 of arg 2
```
### output

``` r
# //NOTE - create summary measures
m <- data.frame(pk)  %>% summarise_all(.funs = mean) %>% mutate(ID="Mean")
```

```
## Warning: There was 1 warning in `summarise()`.
## ℹ In argument: `ID = (function (x, ...) ...`.
## Caused by warning in `mean.default()`:
## ! argument is not numeric or logical: returning NA
```

``` r
sd <- data.frame(pk)  %>% summarise_all(.funs = stats::sd) %>% mutate(ID = "SD")
#//NOTE - special function to return p-value for swilk test 
sw <- function(x){
    result <- shapiro.test(as.double(x))
    return(result$p.value)
}
pv  <- data.frame(pk) %>% summarise_all(.funs = sw)  %>% mutate(ID="SWilk p-value")
pk <- data.frame(pk) %>% bind_rows(m,sd,pv)

# View(pk)
kable(pk)
```



|ID            |        CMAX|      CMAXD|        TMAX|          C0|    AUCPBEO|   AUCPBEP|        CLST|       CLSTP|         TLST|     LAMZHL|        LAMZ|    LAMZLL|     LAMZUL|     LAMZNPT|     CORRXY|         R2|      R2ADJ|       AUCLST|       AUCALL|       AUCIFO|   AUCIFOD|       AUCPEO|    AUCIFP|    AUCIFPD|      AUCPEP|    AUMCLST|      AUMCIFO|      AUMCPEO|     AUMCIFP|     AUMCPEP|     MRTIVLST|   MRTIVIFO|    MRTIVIFP|          VZO|          VZP|          CLO|          CLP|         VSSO|         VSSP|  AUC.0.48h.|
|:-------------|-----------:|----------:|-----------:|-----------:|----------:|---------:|-----------:|-----------:|------------:|----------:|-----------:|---------:|----------:|-----------:|----------:|----------:|----------:|------------:|------------:|------------:|---------:|------------:|---------:|----------:|-----------:|----------:|------------:|------------:|-----------:|-----------:|------------:|----------:|-----------:|------------:|------------:|------------:|------------:|------------:|------------:|-----------:|
|1             | 550.0000000|  0.0275000|   1.0000000|  18.5000000|  0.0000000| 0.0000000|  23.2000000|  23.7910156|    8.0000000|  3.6164087|   0.1916673| 3.0000000|  8.0000000|   3.0000000| -0.9971413|  0.9942909|  0.9885817|  861.2500000|  861.2500000|  982.2930984| 0.0491147|  985.3766484| 0.0492688| 12.3225032|  12.5968733| 1779.20000|  3379.072015| 3.419828e+03|  47.3464906|  47.9739985|    2.0658345|  3.4399835|   3.4705800| 1.062285e+05| 1.058961e+05| 2.036052e+04| 2.029681e+04| 7.003986e+04| 7.044169e+04| 592.1500000|
|2             |  21.1000000|  0.0010550|   2.0000000|  10.3000000|  0.0000000| 0.0000000|   8.0000000|   7.8009375|   10.0000000|  7.2184657|   0.0960242| 3.0000000| 10.0000000|   3.0000000| -0.9887174|  0.9775621|  0.9551243|  126.9500000|  126.9500000|  210.2623578| 0.0105131|  208.1893117| 0.0104095| 39.6230493|  39.0218456|  539.10000|  2239.842197| 2.197523e+03|  75.9313401|  75.4678329|    4.2465538| 10.6526067|  10.5554071| 9.905762e+05| 1.000440e+06| 9.511926e+04| 9.606641e+04| 1.013268e+06| 1.014020e+06|  31.0000000|
|3             |  96.5000000|  0.0048250|   2.0000000|  16.5000000|  0.0000000| 0.0000000|   7.4500000|   8.5459015|    8.0000000|  1.7495769|   0.3961799| 2.0000000|  8.0000000|   4.0000000| -0.9856749|  0.9715550|  0.9573324|  324.2500000|  324.2500000|  343.0545890| 0.0171527|  345.8207604| 0.0172910|  5.4815151|   6.2375551|  978.30000|  1176.201486| 1.205313e+03|  16.8254749|  18.8343587|    3.0171164|  3.4286132|   3.4853690| 1.471548e+05| 1.459777e+05| 5.829976e+04| 5.783343e+04| 1.998873e+05| 2.015708e+05| 102.1000000|
|4             | 134.5000000|  0.0067250|   2.0000000|  16.2000000|  0.0000000| 0.0000000|  10.5000000|   9.6654363|    6.0000000|  1.1627299|   0.5961377| 2.0000000|  6.0000000|   3.0000000| -0.9722488|  0.9452678|  0.8905356|  265.5500000|  265.5500000|  283.1633793| 0.0141582|  281.7634281| 0.0140882|  6.2202179|   5.7542699|  636.70000|   771.926098| 7.611780e+02|  17.5180109|  16.3533390|    2.3976652|  2.7260803|   2.7014791| 1.184803e+05| 1.190690e+05| 7.063060e+04| 7.098153e+04| 1.925447e+05| 1.917551e+05|  99.5500000|
|5             | 109.9000000|  0.0054950|   1.0000000|  34.4000000|  0.0000000| 0.0000000|  39.1000000|  39.1324398|   10.0000000| 16.1972043|   0.0427942| 6.0000000| 10.0000000|   3.0000000| -0.9998592|  0.9997184|  0.9994368|  524.2000000|  524.2000000| 1437.8741916| 0.0718937| 1438.6322333| 0.0719316| 63.5434030|  63.5626126| 2317.30000| 32804.439060| 3.282973e+04|  92.9360170|  92.9414595|    4.4206410| 22.8145406|  22.8201012| 3.250302e+05| 3.248589e+05| 1.390942e+04| 1.390209e+04| 3.173371e+05| 3.172472e+05| 143.4000000|
|6             | 306.0000000|  0.0153000|   2.0000000|  70.0000000|  0.0000000| 0.0000000|  30.2000000|  30.9933827|    6.0000000|  1.1710512|   0.5919017| 2.0000000|  6.0000000|   3.0000000| -0.9971333|  0.9942748|  0.9885495|  980.3000000|  980.3000000| 1031.3219862| 0.0515661| 1032.6623823| 0.0516331|  4.9472412|   5.0706197| 2407.80000|  2800.132019| 2.810439e+03|  14.0111972|  14.3265504|    2.4561869|  2.7150900|   2.7215468| 3.276319e+04| 3.272066e+04| 1.939259e+04| 1.936741e+04| 5.265262e+04| 5.270932e+04| 376.0000000|
|7             | 642.0000000|  0.0321000|   1.0000000| 154.0000000|  0.0000000| 0.0000000|  97.8000000|  92.3471660|    6.0000000|  1.7680711|   0.3920358| 1.0000000|  6.0000000|   4.0000000| -0.9748362|  0.9503057|  0.9254585| 1880.7000000| 1880.7000000| 2130.1670076| 0.1065084| 2116.2579874| 0.1058129| 11.7111478|  11.1308729| 4018.20000|  6151.339345| 6.032406e+03|  34.6776405|  33.3897649|    2.1365449|  2.8877263|   2.8505061| 2.394918e+04| 2.410658e+04| 9.388935e+03| 9.450644e+03| 2.711268e+04| 2.693912e+04| 993.5000000|
|8             |   0.0042650| 10.0000000| 238.8812183|  85.3000000| 10.0000000| 0.0000000| 629.7406091| 629.7406091| 3097.4000000|  4.9185331| 197.8906091| 0.0042650| 10.0000000| 238.8812183| 85.3000000| 10.0000000|  0.0000000|  629.7406091|  629.7406091| 3097.4000000| 4.9185331|  197.8906091| 0.0042650| 10.0000000| 238.8812183|   85.30000|    10.000000| 0.000000e+00| 629.7406091| 629.7406091| 3097.4000000|  4.9185331| 197.8906091| 4.265000e-03| 1.000000e+01| 2.388812e+02| 8.530000e+01| 1.000000e+01| 0.000000e+00| 629.7406091|
|9             | 307.0000000|  0.0153500|   1.0000000|  68.6000000|  0.0000000| 0.0000000|   6.9000000|   4.1873155|   10.0000000|  1.5579688|   0.4449044| 1.0000000| 10.0000000|   6.0000000| -0.9682326|  0.9374744|  0.9218429|  763.0500000|  763.0500000|  778.5589498| 0.0389279|  772.4617196| 0.0386231|  1.9920071|   1.2184060| 1731.10000|  1921.048559| 1.846372e+03|   9.8877542|   6.2431456|    2.2686587|  2.4674414|   2.3902436| 5.773934e+04| 5.819509e+04| 2.568849e+04| 2.589125e+04| 6.338483e+04| 6.188640e+04| 393.9000000|
|10            |  19.5000000|  0.0009750|   1.0000000|  13.1000000|  0.0000000| 0.0000000|   5.2100000|   2.9760654|   10.0000000|  5.8275445|   0.1189433| 1.0000000| 10.0000000|   5.0000000| -0.4477481|  0.2004784| -0.0660289|   60.2300000|   60.2300000|  104.0323957| 0.0052016|   85.2508821| 0.0042625| 42.1045727|  29.3497047|  208.26000|  1014.546888| 6.688286e+02|  79.4726096|  68.8619787|    3.4577453|  9.7522207|   7.8454159| 1.616298e+06| 1.972383e+06| 1.922478e+05| 2.346017e+05| 1.874843e+06| 1.840548e+06|  29.0000000|
|11            | 234.8000000|  0.0117400|   2.0000000|  36.7000000|  2.3720712| 2.2530261|  65.9000000|  81.7439395|    8.0000000|  3.5763985|   0.1938115| 2.0000000|  8.0000000|   3.0000000| -0.9010429|  0.8118782|  0.6237564| 1207.1500000| 1207.1500000| 1547.1710939| 0.0773586| 1628.9203144| 0.0814460| 21.9769549|  25.8926303| 4733.10000|  9207.659408| 1.028345e+04|  48.5960569|  53.9736211|    3.9208880|  5.9512871|   6.3130471| 6.669789e+04| 6.335058e+04| 1.292682e+04| 1.227807e+04| 7.693121e+04| 7.751204e+04| 172.4500000|
|12            | 337.8000000|  0.0168900|   1.0000000|  35.9000000|  0.0000000| 0.0000000|  17.4000000|  11.6818178|    3.0000000|  0.4673978|   1.4829919| 1.0000000|  3.0000000|   3.0000000| -0.9066396|  0.8219953|  0.6439906|  387.6500000|  387.6500000|  399.3830378| 0.0199692|  395.5271960| 0.0197764|  2.9377907|   1.9915687|  410.30000|   453.410848| 4.392433e+02|   9.5081200|   6.5893506|    1.0584290|  1.1352782|   1.1105261| 3.376771e+04| 3.409690e+04| 5.007724e+04| 5.056542e+04| 5.685160e+04| 5.615422e+04| 367.3500000|
|13            |  91.2000000|  0.0045600|   1.0000000|  50.2000000|  0.0000000| 0.0000000|  22.5000000|  20.5871447|    3.0000000|  0.9905360|   0.6997698| 1.0000000|  3.0000000|   3.0000000| -0.9766618|  0.9538683|  0.9077366|  162.2500000|  162.2500000|  194.4034313| 0.0097202|  191.6698819| 0.0095835| 16.5395390|  15.3492461|  194.35000|   336.758878| 3.246519e+02|  42.2880843|  40.1358763|    1.1978428|  1.7322682|   1.6938075| 1.470181e+05| 1.491149e+05| 1.028788e+05| 1.043461e+05| 1.782137e+05| 1.767422e+05| 133.6500000|
|Mean          | 219.2541742|  0.7801935|  19.6831706|  46.9000000|  0.9516978| 0.1733097|  74.1462007|  74.0917824|  245.0307692|  3.8632221|  15.6259824| 1.9234050|  7.5384615|  21.6831706|  5.7064665|  1.5814361|  0.7489474|  628.7131238|  628.7131238|  964.5450399| 0.4146629|  744.6479504| 0.0367994| 18.4153802|  35.0813402| 1541.46231|  4789.721292| 4.832228e+03|  86.0568773|  84.9870681|  240.7726236|  5.7401284|  20.4498953| 2.819772e+05| 3.100169e+05| 5.162763e+04| 5.505124e+04| 3.171598e+05| 3.144251e+05| 312.5992776|
|SD            | 203.1976013|  2.7702238|  65.8626619|  40.3080430|  2.7966088| 0.6248770| 169.0916722| 169.3838221|  857.0338260|  4.2524105|  54.7650046| 1.4974058|  2.5695455|  65.2668611| 23.9153364|  2.5384429|  0.3676071|  515.1004232|  515.1004232|  893.6388787| 1.3536028|  652.4998931| 0.0330527| 18.7600066|  63.7581577| 1497.17181|  8811.954473| 8.883434e+03| 165.7269675| 165.9825607|  858.3103631|  5.8982191|  53.6303191| 4.782627e+05| 5.646845e+05| 5.380147e+04| 6.363123e+04| 5.373660e+05| 5.292584e+05| 286.6036503|
|SWilk p-value |   0.0925339|  0.0000005|   0.0000005|   0.0121066|  0.0000020| 0.0000005|   0.0000034|   0.0000039|    0.0000005|  0.0011364|   0.0000005| 0.0115944|  0.0223261|   0.0000006|  0.0000005|  0.0000013|  0.0003438|    0.1438883|    0.1438883|    0.0411435| 0.0000007|    0.0500826| 0.0632610|  0.0086622|   0.0000211|    0.04025|     0.000024| 2.940000e-05|   0.0000052|   0.0000054|    0.0000005|  0.0006306|   0.0000016| 7.420000e-05| 4.080000e-05| 1.401060e-02| 2.827500e-03| 6.430000e-05| 6.890000e-05|   0.0445289|


``` r
write.csv(pk,"result.csv")
knit("pkpd analysis.rmd")
```

```
## 
## 
## processing file: pkpd analysis.rmd
```

```
## Error in parse_block(g[-1], g[1], params.src, markdown_mode): Duplicate chunk label 'install', which has been used for the chunk:
## # install.packages(c("dplyr", "ggplot2", "tidyr", "readr", "data.table", "lubridate", "caret", "plotly", "knitr", "survival"))
## # install.packages(c("meta","metafor","pkr"))
## # install.packages("openxlsx")
```

# Pharmacokinetic analysis of Eprex

## load packages

``` r
# install.packages(c("dplyr", "ggplot2", "tidyr", "readr", "data.table", "lubridate", "caret", "plotly", "knitr", "survival"))
# install.packages(c("meta","metafor","pkr"))
# install.packages("openxlsx")
```

``` r
library(openxlsx)
library(dplyr)
library(tidyr)
library(readr)
library(knitr)
library(pkr)
```
## load and prepare data

``` r
data  <- read.xlsx("Kinetic_clean.xlsx")
df <- data  %>% mutate(across(seq(5,17,2),.fns = as.double))  %>% 
    mutate(gender_recoded = as.factor(gender))  %>%  
    mutate(c0 = level0, dose = 20000)  %>% 
    reshape(varying = c('level0','level1','level2','level3','level6','level8','level10'), 
        times = c(0,1,2,3,6,8,10), 
        v.names = "concentration", 
        idvar = 'ID',
        drop = c(seq(4,18,2)),
        direction = "long")  %>% 
    arrange(ID)  %>% 
    drop_na(concentration) %>% 
    mutate(, time= time*24) %>% 
    # mutate(concentration = concentration*100) %>% 
    select(ID,time,concentration)
```

```
## Warning: There were 6 warnings in `mutate()`.
## The first warning was:
## ℹ In argument: `across(seq(5, 17, 2), .fns = as.double)`.
## Caused by warning:
## ! NAs introduced by coercion
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 5 remaining warnings.
```

``` r
# View(df)
# glimpse(df)
```
## analyze

``` r
pk <- NCA(
    concData = df,
    id ="ID",
    Time = "time",
    conc = "concentration",
    fit = "Linear",
    iAUC = data.frame(Name = "AUC[0-48h]",Start = 0, End = 2),
    dose = 20000,
    uTime = "h",
    # uConc = "ug/L",
    # uDose = "ug",
    adm = "Bolus"
)
```

```
## Warning in rbind(deparse.level, ...): number of columns of result, 40, is not a
## multiple of vector length 11 of arg 2
```
### output

``` r
# //NOTE - create summary measures
m <- data.frame(pk)  %>% summarise_all(.funs = mean) %>% mutate(ID="Mean")
```

```
## Warning: There was 1 warning in `summarise()`.
## ℹ In argument: `ID = (function (x, ...) ...`.
## Caused by warning in `mean.default()`:
## ! argument is not numeric or logical: returning NA
```

``` r
sd <- data.frame(pk)  %>% summarise_all(.funs = stats::sd) %>% mutate(ID = "SD")
#//NOTE - special function to return p-value for swilk test 
sw <- function(x){
    result <- shapiro.test(as.double(x))
    return(result$p.value)
}
pv  <- data.frame(pk) %>% summarise_all(.funs = sw)  %>% mutate(ID="SWilk p-value")
pk <- data.frame(pk) %>% bind_rows(m,sd,pv)

# View(pk)
kable(pk)
```



|ID            |        CMAX|       CMAXD|        TMAX|          C0|     AUCPBEO|   AUCPBEP|         CLST|        CLSTP|         TLST|      LAMZHL|        LAMZ|      LAMZLL|      LAMZUL|     LAMZNPT|     CORRXY|          R2|      R2ADJ|       AUCLST|       AUCALL|       AUCIFO|     AUCIFOD|       AUCPEO|    AUCIFP|    AUCIFPD|      AUCPEP|      AUMCLST|      AUMCIFO|      AUMCPEO|      AUMCIFP|      AUMCPEP|     MRTIVLST|    MRTIVIFO|    MRTIVIFP|          VZO|          VZP|         CLO|          CLP|         VSSO|         VSSP|   AUC.0.48h.|
|:-------------|-----------:|-----------:|-----------:|-----------:|-----------:|---------:|------------:|------------:|------------:|-----------:|-----------:|-----------:|-----------:|-----------:|----------:|-----------:|----------:|------------:|------------:|------------:|-----------:|------------:|---------:|----------:|-----------:|------------:|------------:|------------:|------------:|------------:|------------:|-----------:|-----------:|------------:|------------:|-----------:|------------:|------------:|------------:|------------:|
|1             | 550.0000000|   0.0275000|  24.0000000|  18.5000000|   0.0000000| 0.0000000| 2.320000e+01| 2.379102e+01| 1.920000e+02|  86.7938094|   0.0079861|  72.0000000| 192.0000000|   3.0000000| -0.9971413|   0.9942909|  0.9885817| 2.067000e+04| 2.067000e+04| 2.357503e+04|   1.1787517| 2.364904e+04| 1.1824520|  12.322503|  12.5968733| 1.024819e+06| 1.946345e+06| 1.969821e+06| 4.734649e+01| 4.797400e+01| 4.958003e+01|  82.5596031|  83.2939191| 1.062285e+05| 1.058961e+05|  848.355073|  845.7003063| 7.003986e+04| 7.044169e+04| 8.129167e+01|
|2             |  21.1000000|   0.0010550|  48.0000000|  10.3000000|   0.0000000| 0.0000000| 8.000000e+00| 7.800937e+00| 2.400000e+02| 173.2431777|   0.0040010|  72.0000000| 240.0000000|   3.0000000| -0.9887174|   0.9775621|  0.9551243| 3.046800e+03| 3.046800e+03| 5.046297e+03|   0.2523148| 4.996543e+03| 0.2498272|  39.623049|  39.0218456| 3.105216e+05| 1.290149e+06| 1.265773e+06| 7.593134e+01| 7.546783e+01| 1.019173e+02| 255.6625603| 253.3297708| 9.905762e+05| 1.000440e+06| 3963.302525| 4002.7671280| 1.013268e+06| 1.014020e+06| 2.101667e+01|
|3             |  96.5000000|   0.0048250|  48.0000000|  16.5000000|   0.0000000| 0.0000000| 7.450000e+00| 8.545901e+00| 1.920000e+02|  41.9898454|   0.0165075|  48.0000000| 192.0000000|   4.0000000| -0.9856749|   0.9715550|  0.9573324| 7.782000e+03| 7.782000e+03| 8.233310e+03|   0.4116655| 8.299698e+03| 0.4149849|   5.481515|   6.2375551| 5.635008e+05| 6.774921e+05| 6.942603e+05| 1.682547e+01| 1.883436e+01| 7.241079e+01|  82.2867164|  83.6488567| 1.471548e+05| 1.459777e+05| 2429.156642| 2409.7261606| 1.998873e+05| 2.015708e+05| 3.542500e+01|
|4             | 134.5000000|   0.0067250|  48.0000000|  16.2000000|   0.0000000| 0.0000000| 1.050000e+01| 9.665436e+00| 1.440000e+02|  27.9055182|   0.0248391|  48.0000000| 144.0000000|   3.0000000| -0.9722488|   0.9452678|  0.8905356| 6.373200e+03| 6.373200e+03| 6.795921e+03|   0.3397961| 6.762322e+03| 0.3381161|   6.220218|   5.7542699| 3.667392e+05| 4.446294e+05| 4.384385e+05| 1.751801e+01| 1.635334e+01| 5.754397e+01|  65.4259262|  64.8354992| 1.184803e+05| 1.190690e+05| 2942.941758| 2957.5638645| 1.925447e+05| 1.917551e+05| 3.306667e+01|
|5             | 109.9000000|   0.0054950|  24.0000000|  34.4000000|   0.0000000| 0.0000000| 3.910000e+01| 3.913244e+01| 2.400000e+02| 388.7329042|   0.0017831| 144.0000000| 240.0000000|   3.0000000| -0.9998592|   0.9997184|  0.9994368| 1.258080e+04| 1.258080e+04| 3.450898e+04|   1.7254490| 3.452717e+04| 1.7263587|  63.543403|  63.5626126| 1.334765e+06| 1.889536e+07| 1.890993e+07| 9.293602e+01| 9.294146e+01| 1.060954e+02| 547.5489734| 547.6824281| 3.250302e+05| 3.248589e+05|  579.559281|  579.2539011| 3.173371e+05| 3.172472e+05| 7.509167e+01|
|6             | 306.0000000|   0.0153000|  48.0000000|  70.0000000|   0.0000000| 0.0000000| 3.020000e+01| 3.099338e+01| 1.440000e+02|  28.1052285|   0.0246626|  48.0000000| 144.0000000|   3.0000000| -0.9971333|   0.9942748|  0.9885495| 2.352720e+04| 2.352720e+04| 2.475173e+04|   1.2375864| 2.478390e+04| 1.2391949|   4.947241|   5.0706197| 1.386893e+06| 1.612876e+06| 1.618813e+06| 1.401120e+01| 1.432655e+01| 5.894849e+01|  65.1621602|  65.3171221| 3.276319e+04| 3.272066e+04|  808.024404|  806.9755882| 5.265262e+04| 5.270932e+04| 1.498333e+02|
|7             | 642.0000000|   0.0321000|  24.0000000| 154.0000000|   0.0000000| 0.0000000| 9.780000e+01| 9.234717e+01| 1.440000e+02|  42.4337062|   0.0163348|  24.0000000| 144.0000000|   4.0000000| -0.9748362|   0.9503057|  0.9254585| 4.513680e+04| 4.513680e+04| 5.112401e+04|   2.5562004| 5.079019e+04| 2.5395096|  11.711148|  11.1308729| 2.314483e+06| 3.543171e+06| 3.474666e+06| 3.467764e+01| 3.338976e+01| 5.127708e+01|  69.3054318|  68.4121460| 2.394918e+04| 2.410658e+04|  391.205633|  393.7768166| 2.711268e+04| 2.693912e+04| 3.486667e+02|
|8             |   0.0042650| 240.0000000| 238.8812183|  85.3000000| 240.0000000| 0.0000000| 1.511377e+04| 1.511377e+04| 1.784102e+06| 118.0447932| 463.5723350|   0.0042650| 240.0000000| 238.8812183| 85.3000000| 240.0000000|  0.0000000| 1.511377e+04| 1.511377e+04| 1.784102e+06| 118.0447932| 4.635723e+02| 0.0042650| 240.000000| 238.8812183| 8.530000e+01| 2.400000e+02| 0.000000e+00| 1.511377e+04| 1.511377e+04| 1.784102e+06| 118.0447932| 463.5723350| 4.265000e-03| 2.400000e+02|  238.881218|   85.3000000| 2.400000e+02| 0.000000e+00| 1.511377e+04|
|9             | 307.0000000|   0.0153500|  24.0000000|  68.6000000|   0.0000000| 0.0000000| 6.900000e+00| 4.187316e+00| 2.400000e+02|  37.3912515|   0.0185377|  24.0000000| 240.0000000|   6.0000000| -0.9682326|   0.9374744|  0.9218429| 1.831320e+04| 1.831320e+04| 1.868541e+04|   0.9342707| 1.853908e+04| 0.9269541|   1.992007|   1.2184060| 9.971136e+05| 1.106524e+06| 1.063510e+06| 9.887754e+00| 6.243146e+00| 5.444781e+01|  59.2185928|  57.3658461| 5.773934e+04| 5.819509e+04| 1070.353547| 1078.8021105| 6.338483e+04| 6.188640e+04| 1.570667e+02|
|10            |  19.5000000|   0.0009750|  24.0000000|  13.1000000|   0.0000000| 0.0000000| 5.210000e+00| 2.976065e+00| 2.400000e+02| 139.8610691|   0.0049560|  24.0000000| 240.0000000|   5.0000000| -0.4477481|   0.2004784| -0.0660289| 1.445520e+03| 1.445520e+03| 2.496777e+03|   0.1248389| 2.046021e+03| 0.1023011|  42.104573|  29.3497047| 1.199578e+05| 5.843790e+05| 3.852453e+05| 7.947261e+01| 6.886198e+01| 8.298589e+01| 234.0532979| 188.2899814| 1.616298e+06| 1.972383e+06| 8010.325320| 9775.0699175| 1.874843e+06| 1.840548e+06| 2.673333e+01|
|11            | 234.8000000|   0.0117400|  48.0000000|  36.7000000|   2.3720712| 2.2530261| 6.590000e+01| 8.174394e+01| 1.920000e+02|  85.8335645|   0.0080755|  48.0000000| 192.0000000|   3.0000000| -0.9010429|   0.8118782|  0.6237564| 2.897160e+04| 2.897160e+04| 3.713211e+04|   1.8566053| 3.909409e+04| 1.9547044|  21.976955|  25.8926303| 2.726266e+06| 5.303612e+06| 5.923268e+06| 4.859606e+01| 5.397362e+01| 9.410131e+01| 142.8308909| 151.5131314| 6.669789e+04| 6.335058e+04|  538.617440|  511.5863103| 7.693121e+04| 7.751204e+04| 7.340000e+01|
|12            | 337.8000000|   0.0168900|  24.0000000|  35.9000000|   0.0000000| 0.0000000| 1.740000e+01| 1.168182e+01| 7.200000e+01|  11.2175477|   0.0617913|  24.0000000|  72.0000000|   3.0000000| -0.9066396|   0.8219953|  0.6439906| 9.303600e+03| 9.303600e+03| 9.585193e+03|   0.4792596| 9.492653e+03| 0.4746326|   2.937791|   1.9915687| 2.363328e+05| 2.611646e+05| 2.530041e+05| 9.508120e+00| 6.589351e+00| 2.540230e+01|  27.2466763|  26.6526267| 3.376771e+04| 3.409690e+04| 2086.551642| 2106.8926280| 5.685160e+04| 5.615422e+04| 9.695833e+01|
|13            |  91.2000000|   0.0045600|  24.0000000|  50.2000000|   0.0000000| 0.0000000| 2.250000e+01| 2.058714e+01| 7.200000e+01|  23.7728643|   0.0291571|  24.0000000|  72.0000000|   3.0000000| -0.9766618|   0.9538683|  0.9077366| 3.894000e+03| 3.894000e+03| 4.665682e+03|   0.2332841| 4.600077e+03| 0.2300039|  16.539539|  15.3492461| 1.119456e+05| 1.939731e+05| 1.869995e+05| 4.228808e+01| 4.013588e+01| 2.874823e+01|  41.5744363|  40.6513789| 1.470181e+05| 1.491149e+05| 4286.618440| 4347.7531528| 1.782137e+05| 1.767422e+05| 1.038167e+02|
|Mean          | 219.2541742|  18.4725012|  49.7600937|  46.9000000|  18.6440055| 0.1733097| 1.188303e+03| 1.188248e+03| 1.374011e+05|  92.7173292|  35.6762282|  46.1541742| 180.9230769|  21.6831706|  5.7064665|  19.2737438|  0.7489474| 1.508911e+04| 1.508911e+04| 1.546695e+05|   9.9519089| 1.754187e+04| 0.8756388|  36.107688|  35.0813402| 8.841094e+05| 2.758455e+06| 2.783363e+06| 1.200213e+03| 1.199144e+03| 1.372989e+05| 137.7630815| 161.1203878| 2.819772e+05| 3.100346e+05| 2168.760994| 2300.0898372| 3.171774e+05| 3.144251e+05| 1.255088e+03|
|SD            | 203.1976013|  66.5607304|  58.0426326|  40.3080430|  66.5124302| 0.6248770| 4.184170e+03| 4.184198e+03| 4.947722e+05| 102.0578525| 128.5667804|  35.9482251|  61.6690921|  65.2668611| 23.9153364|  66.3203293|  0.3676071| 1.236241e+04| 1.236241e+04| 4.898118e+05|  32.4864682| 1.600068e+04| 0.8017315|  64.020146|  63.7581577| 8.664440e+05| 5.075936e+06| 5.116858e+06| 4.180598e+03| 4.180917e+03| 4.948029e+05| 141.5572588| 166.5088773| 4.782627e+05| 5.646740e+05| 2224.337678| 2645.5073066| 5.373547e+05| 5.292584e+05| 4.164913e+03|
|SWilk p-value |   0.0925339|   0.0000005|   0.0000054|   0.0121066|   0.0000005| 0.0000005| 5.000000e-07| 5.000000e-07| 5.000000e-07|   0.0011364|   0.0000005|   0.0116888|   0.0223261|   0.0000006|  0.0000005|   0.0000005|  0.0003438| 1.438883e-01| 1.438883e-01| 7.000000e-07|   0.0000007| 9.762940e-02| 0.1077042|   0.000025|   0.0000211| 5.168960e-02| 2.410000e-05| 2.940000e-05| 5.000000e-07| 5.000000e-07| 5.000000e-07|   0.0006306|   0.0017019| 7.420000e-05| 4.070000e-05|    0.008931|    0.0024867| 6.420000e-05| 6.890000e-05| 6.000000e-07|
### plot

``` r
plotPK(
    concData = df,
    id ="ID",
    Time = "time",
    conc = "concentration",
    fit = "Linear",
    dose = 20000,
    unitTime = "h",
    # unitConc = "ug/L",
    adm = "Bolus"
)
```

```
## Warning in rbind(deparse.level, ...): number of columns of result, 39, is not a
## multiple of vector length 10 of arg 2
```

```
## Error in rbind(deparse.level, ...): numbers of columns of arguments do not match
```

``` r
write.csv(pk,"result.csv")
knit("pkpd analysis.rmd")
```

```
## 
## 
## processing file: pkpd analysis.rmd
```

```
## Error in parse_block(g[-1], g[1], params.src, markdown_mode): Duplicate chunk label 'install', which has been used for the chunk:
## # install.packages(c("dplyr", "ggplot2", "tidyr", "readr", "data.table", "lubridate", "caret", "plotly", "knitr", "survival"))
## # install.packages(c("meta","metafor","pkr"))
## # install.packages("openxlsx")
```
